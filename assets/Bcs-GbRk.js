import{H as E,_,r as k,I as F,t as u,v as c,x as r,J as G,K as C,y as w,L as P,M as D,N as j,j as v,O as J,z as B,P as l}from"./B_np2hTD.js";const K=6,U="https://deckofcardsapi.com/api/deck";let N="";async function L(e){try{return await(await fetch(`${U}${e}`)).json()}catch(a){throw console.error("Ошибка API колоды:",a),a}}const q=async function(){try{return N=(await L(`/new/shuffle/?deck_count=${K}`)).deck_id,!0}catch(e){return console.warn("Не удалось получить ID колоды:",e),!1}},x=async function(){return L(`/${N}/draw/?count=1`)},z=E("game",{state:()=>({playerCards:[],dealerCards:[],gameStatus:"idle",winner:null,message:"",isLoading:!1}),getters:{playerScore(){return this.calculateScore(this.playerCards)},dealerScore(){return this.calculateScore(this.dealerCards)},playerHasBlackjack(){return this.playerCards.length===2&&this.playerScore===21},dealerHasBlackjack(){return this.dealerCards.length===2&&this.dealerScore===21},isGameOver(){return this.gameStatus==="finished"}},actions:{hasSoft17(){if(this.dealerScore!==17)return!1;let e=0,a=0;for(const t of this.dealerCards)t.value==="ACE"?e++:["KING","QUEEN","JACK"].includes(t.value)?a+=10:a+=parseInt(t.value);return e>0&&a===6},calculateScore(e){if(!e||e.length===0)return 0;let a=0,t=0;const i=e.reduce((s,o)=>{const n=o.value;return n==="ACE"?(s.aceCount++,s.score+=11):["KING","QUEEN","JACK"].includes(n)?s.score+=10:s.score+=parseInt(n),s},{score:0,aceCount:0});for(a=i.score,t=i.aceCount;a>21&&t>0;)a-=10,t--;return a},async startNewGame(){this.isLoading=!0,this.playerCards=[],this.dealerCards=[],this.gameStatus="playing",this.winner=null,this.message="";try{await q();const e=await L(`/${N}/draw/?count=4`);if(e.cards&&e.cards.length===4){this.playerCards=[e.cards[0],e.cards[1]],this.dealerCards=[e.cards[2],e.cards[3]];const a=this.playerScore===21&&this.playerCards.length===2,t=this.dealerScore===21&&this.dealerCards.length===2;a||t?(this.gameStatus="finished",this.winner=a&&t?"tie":a?"player":"dealer",a&&t?this.message="Ничья! У вас и у дилера Black Jack.":a?this.message="Вы выиграли с Black Jack! Поздравляем!":this.message="Дилер выиграл с Black Jack!"):(this.gameStatus="playerTurn",this.message="Карты разданы. Ваш ход!")}}catch{this.message="Ошибка при начале игры. Пожалуйста, попробуйте еще раз.",this.gameStatus="idle"}finally{this.isLoading=!1}},async playerHit(){if(!(this.gameStatus!=="playerTurn"||this.playerScore>=21)){this.isLoading=!0;try{const e=await x();e.cards&&e.cards.length===1&&(this.playerCards.push(e.cards[0]),this.message="Вы взяли карту...")}catch{this.message="Ошибка при взятии карты. Пожалуйста, попробуйте еще раз."}finally{this.isLoading=!1}}},onCardFlipped(e){this.playerCards.some(a=>a.code===e.code)&&this.gameStatus==="playerTurn"?(this.message=`Вы взяли ${e.value} ${e.suit}. Ваш счет: ${this.playerScore}`,this.checkPlayerBust()):this.dealerCards.some(a=>a.code===e.code)&&(this.message="")},checkPlayerBust(){return this.gameStatus==="playerTurn"&&this.playerScore>21?(this.gameStatus="finished",this.winner="dealer",this.message="Перебор! Вы набрали больше 21 очка. Вы проиграли.",!0):!1},async playerStand(){this.gameStatus==="playerTurn"&&(this.gameStatus="dealerTurn",await this.dealerPlay())},showNotification(e,a,t="info",i=!1){a&&(this.message=a)},async dealerPlay(){this.isLoading=!0;try{for(this.message="";this.dealerScore<17||this.hasSoft17();){await new Promise(a=>setTimeout(a,400));const e=await x();if(!(e.cards&&e.cards.length===1))break;this.dealerCards.push(e.cards[0]),await new Promise(a=>setTimeout(a,1e3))}if(this.gameStatus="finished",this.dealerScore>21)this.winner="player",this.message="Дилер перебрал! Вы выиграли.";else{const e=this.dealerScore>this.playerScore,a=this.dealerScore<this.playerScore,t=this.dealerScore===this.playerScore;e?(this.winner="dealer",this.message="Дилер выиграл!"):a?(this.winner="player",this.message="Вы выиграли!"):t&&(this.winner="tie",this.message="Ничья! У вас и у дилера одинаковое количество очков.")}}catch{this.message="Ошибка в ходе дилера. Пожалуйста, попробуйте еще раз.",this.gameStatus="idle"}finally{this.isLoading=!1}}}}),O={class:"card-container"},Q={class:"flipper"},V={class:"back"},W={class:"card-front"},R=["src","alt"],M={__name:"Card",props:{card:{type:Object,required:!0},hidden:{type:Boolean,default:!1},index:{type:Number,default:0}},emits:["card-flipped"],setup(e,{emit:a}){const t=e,i=a,s=k(!0),o=(n=0)=>{t.hidden||setTimeout(()=>{s.value=!1,setTimeout(()=>i("card-flipped",t.card),600)},n)};return o(500+t.index*300),F(()=>t.hidden,n=>{n||o(300)}),(n,h)=>(c(),u("div",O,[r("div",{class:G(["flip-container",{flipped:!s.value&&!e.hidden}])},[r("div",Q,[h[0]||(h[0]=r("div",{class:"front"},[r("div",{class:"card-back"})],-1)),r("div",V,[r("div",W,[r("img",{class:"card-image",src:e.card.image,alt:`${e.card.value} of ${e.card.suit}`},null,8,R)])])])],2)]))}},X=_(M,[["__scopeId","data-v-b1d5c813"]]),Y={class:"hand-container"},Z={class:"hand-title"},ee={key:0,class:"score-display"},ae={key:1,class:"cards-container"},te={key:2,class:"empty-hand"},se={__name:"Hand",props:{title:{type:String,required:!0},cards:{type:Array,required:!0},score:{type:Number,default:0},isDealer:{type:Boolean,default:!1},hideFirstCard:{type:Boolean,default:!1},showScore:{type:Boolean,default:!0},gameStatus:{type:String,default:"playing"}},emits:["all-cards-flipped","card-flipped"],setup(e,{emit:a}){const t=e,i=a,s=k(new Set),o=k(!1),n=p=>!t.isDealer||t.gameStatus==="finished"?!1:t.hideFirstCard&&p===1,h=p=>{const d=p.code||p.image;s.value.add(d),i("card-flipped",p);const f=t.cards.filter((y,b)=>!n(b)).length;s.value.size>=f&&!o.value&&(o.value=!0,i("all-cards-flipped",t.title))};return F(()=>t.cards,()=>{s.value.clear(),o.value=!1},{deep:!0}),(p,d)=>(c(),u("div",Y,[r("h2",Z,w(e.title),1),e.showScore?(c(),u("div",ee,"Счет: "+w(e.score),1)):C("",!0),e.cards&&e.cards.length>0?(c(),u("div",ae,[(c(!0),u(P,null,D(e.cards,(f,y)=>(c(),j(X,{key:f.code||y,card:f,index:y,hidden:n(y),onCardFlipped:h},null,8,["card","index","hidden"]))),128))])):(c(),u("div",te,d[0]||(d[0]=[r("div",{class:"placeholder"},"Ожидание карт...",-1)])))]))}},H=_(se,[["__scopeId","data-v-8ea31420"]]),re={class:"controls-container"},ie={class:"buttons-row"},le=["disabled"],ne=["disabled"],de=["disabled"],oe={key:0,class:"loader"},ce={__name:"GameControls",props:{gameStatus:{type:String,required:!0},message:{type:String,default:""},isLoading:{type:Boolean,default:!1},playerScore:{type:Number,default:0}},emits:["start-game","player-hit","player-stand"],setup(e,{emit:a}){const t=e,i=a,s=v(()=>t.gameStatus==="idle"?"Начать игру":"Новая игра"),o=v(()=>t.gameStatus==="idle"||t.gameStatus==="finished"),n=v(()=>t.gameStatus==="playerTurn"),h=v(()=>t.playerScore<21);return(p,d)=>(c(),u("div",re,[r("div",ie,[o.value?(c(),u("button",{key:0,class:"control-btn start-btn",onClick:d[0]||(d[0]=f=>i("start-game")),disabled:e.isLoading},w(s.value),9,le)):C("",!0),n.value?(c(),u(P,{key:1},[r("button",{class:"control-btn hit-btn",onClick:d[1]||(d[1]=f=>i("player-hit")),disabled:e.isLoading||!h.value},"Взять карту",8,ne),r("button",{class:"control-btn stand-btn",onClick:d[2]||(d[2]=f=>i("player-stand")),disabled:e.isLoading},"Остановиться",8,de)],64)):C("",!0)]),e.isLoading?(c(),u("div",oe,d[3]||(d[3]=[r("span",null,"Загрузка...",-1)]))):C("",!0)]))}},ue=_(ce,[["__scopeId","data-v-db80172f"]]),he={class:"blackjack-container"},pe={key:0,class:"message-container"},fe={class:"game-message"},me={class:"game-table"},ge={__name:"index",setup(e){const a=z(),{playerCards:t,dealerCards:i,gameStatus:s,message:o,isLoading:n,playerScore:h,dealerScore:p}=J(a),{startNewGame:d,playerHit:f,playerStand:y,checkPlayerBust:b,onCardFlipped:I}=a,S=k(new Set),$=k(!0);F(()=>s.value,m=>{m==="playing"&&(S.value.clear(),$.value=!0)});const A=v(()=>{if(s.value==="playerTurn"&&i.value.length>0){const m=i.value[0];let g=0;return m.value==="ACE"?g=11:["KING","QUEEN","JACK"].includes(m.value)?g=10:g=parseInt(m.value),g}return p.value}),T=m=>{S.value.add(m),m==="Игрок"&&b(),(S.value.size>=2||S.value.has("Дилер")&&i.value.length===0||S.value.has("Игрок")&&t.value.length===0)&&($.value=!0)};return(m,g)=>(c(),u("div",he,[l(o)&&$.value?(c(),u("div",pe,[r("p",fe,w(l(o)),1)])):C("",!0),g[1]||(g[1]=r("div",{class:"game-header"},[r("h1",{class:"game-title"},"Black Jack")],-1)),r("div",me,[B(H,{title:"Дилер",cards:l(i),score:A.value,isDealer:!0,hideFirstCard:l(s)==="playerTurn",showScore:!0,gameStatus:l(s),onAllCardsFlipped:T,onCardFlipped:l(I)},null,8,["cards","score","hideFirstCard","gameStatus","onCardFlipped"]),g[0]||(g[0]=r("div",{class:"table-divider"},null,-1)),B(H,{title:"Игрок",cards:l(t),score:l(h),gameStatus:l(s),onAllCardsFlipped:T,onCardFlipped:l(I)},null,8,["cards","score","gameStatus","onCardFlipped"])]),B(ue,{gameStatus:l(s),message:l(o),isLoading:l(n),playerScore:l(h),onStartGame:l(d),onPlayerHit:l(f),onPlayerStand:l(y)},null,8,["gameStatus","message","isLoading","playerScore","onStartGame","onPlayerHit","onPlayerStand"])]))}},Se=_(ge,[["__scopeId","data-v-4334437b"]]);export{Se as default};
