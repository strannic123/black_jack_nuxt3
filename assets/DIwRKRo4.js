import{H as j,_ as F,r as b,I as T,t as h,v as u,x as l,J,j as k,K,L as _,y as N,M as D,N as q,O as U,P as W,Q as z,R as Q,z as L,S as o}from"./BKB7z1nj.js";const M=6,R="https://deckofcardsapi.com/api/deck";let I="";async function P(e){try{return await(await fetch(`${R}${e}`)).json()}catch(t){throw console.error("Ошибка API колоды:",t),t}}const V=async function(){try{return I=(await P(`/new/shuffle/?deck_count=${M}`)).deck_id,!0}catch(e){return console.warn("Не удалось получить ID колоды:",e),!1}},E=async function(){return P(`/${I}/draw/?count=1`)},X=j("game",{state:()=>({playerCards:[],dealerCards:[],gameStatus:"idle",winner:null,message:"",isLoading:!1}),getters:{playerScore(){return this.calculateScore(this.playerCards)},dealerScore(){return this.calculateScore(this.dealerCards)},playerHasBlackjack(){return this.playerCards.length===2&&this.playerScore===21},dealerHasBlackjack(){return this.dealerCards.length===2&&this.dealerScore===21},isGameOver(){return this.gameStatus==="finished"}},actions:{hasSoft17(){if(this.dealerScore!==17)return!1;let e=0,t=0;for(const a of this.dealerCards)a.value==="ACE"?e++:["KING","QUEEN","JACK"].includes(a.value)?t+=10:t+=parseInt(a.value);return e>0&&t===6},calculateScore(e){if(!e||e.length===0)return 0;let t=0,a=0;const n=e.reduce((s,d)=>{const c=d.value;return c==="ACE"?(s.aceCount++,s.score+=11):["KING","QUEEN","JACK"].includes(c)?s.score+=10:s.score+=parseInt(c),s},{score:0,aceCount:0});for(t=n.score,a=n.aceCount;t>21&&a>0;)t-=10,a--;return t},async startNewGame(){this.isLoading=!0,this.playerCards=[],this.dealerCards=[],this.gameStatus="playing",this.winner=null,this.message="";try{await V();const e=await P(`/${I}/draw/?count=4`);if(e.cards&&e.cards.length===4){this.playerCards=[e.cards[0],e.cards[1]],this.dealerCards=[e.cards[2],e.cards[3]];const t=this.playerScore===21&&this.playerCards.length===2,a=this.dealerScore===21&&this.dealerCards.length===2;t||a?(this.gameStatus="finished",this.winner=t&&a?"tie":t?"player":"dealer",t&&a?this.message="Ничья! У вас и у дилера Black Jack.":t?this.message="Вы выиграли с Black Jack! Поздравляем!":this.message="Дилер выиграл с Black Jack!"):(this.gameStatus="playerTurn",this.message="Карты разданы. Ваш ход!")}}catch{this.message="Ошибка при начале игры. Пожалуйста, попробуйте еще раз.",this.gameStatus="idle"}finally{this.isLoading=!1}},async playerHit(){if(!(this.gameStatus!=="playerTurn"||this.playerScore>=21)){this.isLoading=!0;try{const e=await E();e.cards&&e.cards.length===1&&(this.playerCards.push(e.cards[0]),this.message="Вы взяли карту...")}catch{this.message="Ошибка при взятии карты. Пожалуйста, попробуйте еще раз."}finally{this.isLoading=!1}}},onCardFlipped(e){this.playerCards.some(t=>t.code===e.code)&&this.gameStatus==="playerTurn"?(this.message=`Вы взяли ${e.value} ${e.suit}. Ваш счет: ${this.playerScore}`,this.checkPlayerBust()):this.dealerCards.some(t=>t.code===e.code)&&(this.message="")},checkPlayerBust(){return this.gameStatus==="playerTurn"&&this.playerScore>21?(this.gameStatus="finished",this.winner="dealer",this.message="Перебор! Вы набрали больше 21 очка. Вы проиграли.",!0):!1},async playerStand(){this.gameStatus==="playerTurn"&&(this.gameStatus="dealerTurn",await this.dealerPlay())},showNotification(e,t){t&&(this.message=t)},async dealerPlay(){this.isLoading=!0;try{for(this.message="";this.dealerScore<17||this.hasSoft17();){await new Promise(t=>setTimeout(t,400));const e=await E();if(!(e.cards&&e.cards.length===1))break;this.dealerCards.push(e.cards[0]),await new Promise(t=>setTimeout(t,1e3))}if(this.gameStatus="finished",this.dealerScore>21)this.winner="player",this.message="Дилер перебрал! Вы выиграли.";else{const e=this.dealerScore>this.playerScore,t=this.dealerScore<this.playerScore,a=this.dealerScore===this.playerScore;e?(this.winner="dealer",this.message="Дилер выиграл!"):t?(this.winner="player",this.message="Вы выиграли!"):a&&(this.winner="tie",this.message="Ничья! У вас и у дилера одинаковое количество очков.")}}catch{this.message="Ошибка в ходе дилера. Пожалуйста, попробуйте еще раз.",this.gameStatus="idle"}finally{this.isLoading=!1}}}}),Y={class:"card-container"},Z={class:"flipper"},ee={class:"back"},te={class:"card-front"},ae=["src","alt"],se={__name:"Card",props:{card:{type:Object,required:!0},hidden:{type:Boolean,default:!1},index:{type:Number,default:0}},emits:["card-flipped"],setup(e,{emit:t}){const a=e,n=t,s=b(!0),d=(c=0)=>{a.hidden||setTimeout(()=>{s.value=!1,setTimeout(()=>n("card-flipped",a.card),600)},c)};return d(500+a.index*300),T(()=>a.hidden,c=>{c||d(300)}),(c,m)=>(u(),h("div",Y,[l("div",{class:J(["flip-container",{flipped:!s.value&&!e.hidden}])},[l("div",Z,[m[0]||(m[0]=l("div",{class:"front"},[l("div",{class:"card-back"})],-1)),l("div",ee,[l("div",te,[l("img",{class:"card-image",src:e.card.image,alt:`${e.card.value} of ${e.card.suit}`},null,8,ae)])])])],2)]))}},re=F(se,[["__scopeId","data-v-d9dd0cf6"]]),ie={class:"hand-container"},le={class:"hand-title"},ne={key:0,class:"score-display"},oe={key:1,class:"cards-container"},de={key:2,class:"empty-hand"},ce={__name:"Hand",props:{title:{type:String,required:!0},cards:{type:Array,required:!0},score:{type:Number,default:0},isDealer:{type:Boolean,default:!1},hideFirstCard:{type:Boolean,default:!1},showScore:{type:Boolean,default:!0},gameStatus:{type:String,default:"playing"}},emits:["all-cards-flipped","card-flipped"],setup(e,{emit:t}){const a=e,n=t,s=b(new Set),d=b(!1),c=i=>!a.isDealer||a.gameStatus==="finished"?!1:a.hideFirstCard&&i===1,m=i=>{const p=i.code||i.image;s.value.add(p),n("card-flipped",i);const g=a.cards.filter((C,y)=>!c(y)).length;s.value.size>=g&&!d.value&&(d.value=!0,n("all-cards-flipped",a.title))};T(()=>a.cards,()=>{s.value.clear(),d.value=!1},{deep:!0});const $=k(()=>{const p=window.innerWidth,g=Math.max(50-(a.cards.length-1)*5,10);return p<=768?g:50});return K(()=>{window.innerWidth<=768&&document.documentElement.style.setProperty("--card-overlap",`${$.value}px`)}),(i,p)=>{const g=re;return u(),h("div",ie,[l("h2",le,N(e.title),1),e.showScore?(u(),h("div",ne,"Счет: "+N(e.score),1)):_("",!0),e.cards&&e.cards.length>0?(u(),h("div",oe,[(u(!0),h(D,null,q(e.cards,(C,y)=>(u(),U(g,{key:C.code||y,card:C,index:y,hidden:c(y),onCardFlipped:m,style:W({"--card-index":y})},null,8,["card","index","hidden","style"]))),128))])):(u(),h("div",de,p[0]||(p[0]=[l("div",{class:"placeholder"},"Ожидание карт...",-1)])))])}}},G=F(ce,[["__scopeId","data-v-c4c5e710"]]),ue={class:"controls-container"},he={class:"buttons-row"},pe=["disabled"],me=["disabled"],fe=["disabled"],ye={key:0,class:"loader"},ge={__name:"GameControls",props:{gameStatus:{type:String,required:!0},message:{type:String,default:""},isLoading:{type:Boolean,default:!1},playerScore:{type:Number,default:0}},emits:["start-game","player-hit","player-stand"],setup(e,{emit:t}){const a=e,n=t,s=k(()=>a.gameStatus==="idle"?"Начать игру":"Новая игра"),d=k(()=>a.gameStatus==="idle"||a.gameStatus==="finished"),c=k(()=>a.gameStatus==="playerTurn"),m=k(()=>a.playerScore<21);return($,i)=>(u(),h("div",ue,[l("div",he,[d.value?(u(),h("button",{key:0,class:"control-btn start-btn",onClick:i[0]||(i[0]=p=>n("start-game")),disabled:e.isLoading},N(s.value),9,pe)):_("",!0),c.value?(u(),h(D,{key:1},[l("button",{class:"control-btn hit-btn",onClick:i[1]||(i[1]=p=>n("player-hit")),disabled:e.isLoading||!m.value},"Взять карту",8,me),l("button",{class:"control-btn stand-btn",onClick:i[2]||(i[2]=p=>n("player-stand")),disabled:e.isLoading},"Остановиться",8,fe)],64)):_("",!0)]),e.isLoading?(u(),h("div",ye,i[3]||(i[3]=[l("span",null,"Загрузка...",-1)]))):_("",!0)]))}},ve=F(ge,[["__scopeId","data-v-5339018d"]]),Se={class:"blackjack-container"},Ce={key:0,class:"message-container"},ke={class:"game-message"},we={class:"game-table"},_e={__name:"index",setup(e){const t=X(),{playerCards:a,dealerCards:n,gameStatus:s,message:d,isLoading:c,playerScore:m,dealerScore:$}=z(t),{playerHit:i,playerStand:p,checkPlayerBust:g,onCardFlipped:C}=t,y=()=>{H(),t.startNewGame()},w=b(new Set),v=b(!0);let S=null;const H=()=>{S&&clearTimeout(S);const r=document.querySelector(".message-container");r?(r.style.opacity="0",setTimeout(()=>{v.value=!1},500)):v.value=!1},x=(r=5e3)=>{S&&clearTimeout(S),S=setTimeout(()=>{H()},r)};Q(()=>{S&&clearTimeout(S)});const B=()=>{setTimeout(()=>{const r=document.querySelector(".message-container");r&&(r.style.opacity="1")},10)};T(()=>s.value,r=>{r==="playing"?(w.value.clear(),v.value=!0,B()):r==="finished"&&(v.value=!0,B(),x(1e4))}),T(()=>d.value,r=>{r&&s.value==="finished"&&(v.value=!0,B(),x(1e4))});const O=k(()=>{if(s.value==="playerTurn"&&n.value.length>0){const r=n.value[0];let f=0;return r.value==="ACE"?f=11:["KING","QUEEN","JACK"].includes(r.value)?f=10:f=parseInt(r.value),f}return $.value}),A=r=>{w.value.add(r),r==="Игрок"&&g(),(w.value.size>=2||w.value.has("Дилер")&&n.value.length===0||w.value.has("Игрок")&&a.value.length===0)&&(v.value=!0,s.value==="finished"&&(B(),x(1e4)))};return(r,f)=>(u(),h("div",Se,[o(d)&&v.value?(u(),h("div",Ce,[l("p",ke,N(o(d)),1)])):_("",!0),f[1]||(f[1]=l("div",{class:"game-header"},[l("h1",{class:"game-title"},"Black Jack")],-1)),l("div",we,[L(G,{title:"Дилер",cards:o(n),score:O.value,isDealer:!0,hideFirstCard:o(s)==="playerTurn",showScore:!0,gameStatus:o(s),onAllCardsFlipped:A,onCardFlipped:o(C)},null,8,["cards","score","hideFirstCard","gameStatus","onCardFlipped"]),f[0]||(f[0]=l("div",{class:"table-divider"},null,-1)),L(G,{title:"Игрок",cards:o(a),score:o(m),gameStatus:o(s),onAllCardsFlipped:A,onCardFlipped:o(C)},null,8,["cards","score","gameStatus","onCardFlipped"])]),L(ve,{gameStatus:o(s),message:o(d),isLoading:o(c),playerScore:o(m),onStartGame:y,onPlayerHit:o(i),onPlayerStand:o(p)},null,8,["gameStatus","message","isLoading","playerScore","onPlayerHit","onPlayerStand"])]))}},$e=F(_e,[["__scopeId","data-v-eb7bfdd1"]]);export{$e as default};
